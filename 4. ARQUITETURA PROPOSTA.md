# 4. ARQUITETURA PROPOSTA

## 4.1. Visão Geral da Arquitetura IAM

A arquitetura proposta é baseada em um modelo centralizado e híbrido, que integra sistemas on-premises e em nuvem. O Microsoft Entra ID será o Identity Provider (IdP) principal, atuando como a fonte única da verdade para todas as identidades de usuários (colaboradores, parceiros, clientes). A solução de governança de identidades (IGA) será responsável por automatizar o ciclo de vida de acessos e garantir a conformidade.

## 4.2. Componentes Principais do Sistema

*   **Identity Provider (IdP):** Microsoft Entra ID (Azure AD).
*   **Identity Governance and Administration (IGA):** SailPoint IdentityNow ou Saviynt.
*   **Privileged Access Management (PAM):** CyberArk ou BeyondTrust.
*   **Single Sign-On (SSO):** Federação via SAML 2.0 e OpenID Connect.
*   **Multi-Factor Authentication (MFA):** Microsoft Authenticator, FIDO2/WebAuthn.
*   **Gateway de Acesso:** Para integração com sistemas legados que não suportam protocolos modernos.

## 4.3. Integração com Sistemas Existentes

A integração com o Active Directory on-premises será realizada através do Entra ID Connect. Para sistemas legados, serão utilizados conectores específicos ou um gateway de acesso que traduza os protocolos de autenticação. Aplicações modernas serão integradas via SAML, OpenID Connect e SCIM para provisionamento.

## 4.4. Diagramas de Arquitetura

**Diagrama de Alto Nível:**

```
+-----------------+      +-----------------+      +-----------------+
|   Usuários      |----->|   Entra ID (IdP)  |<---->|   Aplicações    |
| (Colaboradores) |      | (SSO, MFA)      |      | (Cloud & On-prem) |
+-----------------+      +-------+---------+      +--------+--------+
                                 |
                                 v
+-----------------+      +-------+---------+
|   Sistemas      |----->|   IGA (SailPoint) |
| (Legados)       |      | (Governança)    |
+-----------------+      +-----------------+
```

## 4.5. Fluxos de Autenticação e Autorização

**Fluxo de SSO (SAML):**

1.  Usuário acessa a aplicação (Service Provider).
2.  Aplicação redireciona o usuário para o Entra ID (Identity Provider).
3.  Entra ID autentica o usuário (com MFA, se necessário).
4.  Entra ID envia uma asserção SAML para a aplicação.
5.  Aplicação valida a asserção e concede o acesso.

**Fluxo de Provisionamento (SCIM):**

1.  RH contrata um novo colaborador no sistema de RH.
2.  IGA detecta o novo colaborador.
3.  IGA cria a identidade do usuário no Entra ID.
4.  IGA provisiona as contas e os acessos nas aplicações de destino via SCIM.
